<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My digital space</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        /* Style for the fixed header */
        #main-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Style for the modal */
        #markdown-modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        #modal-content {
            max-height: 65vh;
            overflow-y: auto;
        }
        /* Basic styling for rendered Markdown content */
        .markdown-body h1, .markdown-body h2, .markdown-body h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-weight: 600; }
        .markdown-body h1 { font-size: 1.8em; }
        .markdown-body h2 { font-size: 1.5em; }
        .markdown-body h3 { font-size: 1.2em; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.6; }
        .markdown-body a { color: #3b82f6; text-decoration: underline; }
        .markdown-body code { background-color: #f3f4f6; padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; }
        .markdown-body pre { background-color: #f3f4f6; padding: 1em; border-radius: 6px; overflow-x: auto; }
        .markdown-body pre code { background-color: transparent; padding: 0; }
        .markdown-body ul, .markdown-body ol { margin-left: 1.5em; margin-bottom: 1em; }
        .markdown-body li { margin-bottom: 0.5em; }
        .markdown-body blockquote { border-left: 4px solid #d1d5db; padding-left: 1em; color: #6b7280; margin-left: 0; margin-bottom: 1em; }
         .markdown-body ul, .markdown-body ol {
            margin-left: 1.5em; /* Indentation */
            margin-bottom: 1em;
            padding-left: 1.25em; /* Add padding for the bullets/numbers */
        }
        .markdown-body ul {
            list-style-type: disc;
        }
        .markdown-body ol {
            list-style-type: decimal;
        }
        .markdown-body li {
             margin-bottom: 0.5em;
        }

        /* Styling for project lists */
        .project-list {
            list-style: disc; /* Use disc bullet points */
            padding-left: 1.5rem; /* Indent bullet points */
            margin-top: 0.5rem; /* Space above list */
        }
        .project-list li {
            margin-bottom: 0.25rem; /* Space between list items */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <script id="portfolio-data-yaml" type="text/yaml">
# Configuration 

githubUsername: jasperdj 

# Define the categories/columns to display
# - id: A unique identifier used to link projects to categories
# - title: The heading text displayed for the column
categories:
  - id: tool
    title: üõ†Ô∏è Tools
  - id: poc
    title: "üìä POC's" # Use quotes if title contains special characters like apostrophe
  - id: game
    title: üéÆ Games
  - id: opinion
    title: ‚úçÔ∏è Thoughts

# List of projects
# - title: Display name of the project/article
# - url: Full URL for external links (type: link), relative path for local markdown (type: markdown)
# - type: 'link' or 'markdown'
# - category: The 'id' of the category this project belongs to

projects:
  # --- TOOLS ---
  - title: Text Encryptor/Decryptor
    url: https://jasperdj.github.io/encrypt/
    type: link
    category: tool

  # --- POCs ---
  - title: Pure frontend P2P chat
    url: https://jasperdj.github.io/peared/
    type: link
    category: poc

  # --- GAMES ---
  - title: World of Risk
    url: https://jasperdj.github.io/WorldOfRisk/
    type: link
    category: game

  - title: MicroEvolution
    url: https://jasperdj.github.io/MicroEvolution/
    type: link
    category: game

  # --- OPINIONS ---
  - title: Widespread casual financial advice is a symptom of a societal gambling illness
    url: opinions/casual-financial-advice.md # IMPORTANT: Create this file in an 'opinions' folder
    type: markdown
    category: opinion

    </script>

    <header id="main-header" class="py-4">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-900">My Digital Space</h1>
            <nav>
                </nav>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="intro" class="mb-12 text-center">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Welcome!</h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                Explore my collection of proof of concepts, tools, games, and thoughts.
            </p>
        </section>

        <section id="projects">
            <div id="project-columns" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-6">
                <p class="text-gray-500 col-span-full text-center">Loading project categories...</p>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-gray-300 py-6 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p><span id="current-year" style="display:none;"></span>Find me on <a id="footer-github-link" href="#" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">GitHub</a>.</p>
            </div>
    </footer>

    <div id="markdown-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl relative">
            <div class="flex justify-between items-center p-4 border-b border-gray-200">
                 <h3 id="modal-title" class="text-xl font-semibold text-gray-800">Reading Article</h3>
                 <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-content" class="p-6 markdown-body max-h-[75vh] overflow-y-auto">
                <p class="text-center text-gray-500">Loading content...</p>
            </div>
             <div class="flex justify-end p-4 border-t border-gray-200">
                 <button id="close-modal-footer-btn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Close</button>
            </div>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const projectColumnsContainer = document.getElementById('project-columns');
        const yamlDataElement = document.getElementById('portfolio-data-yaml');
        const currentYearSpan = document.getElementById('current-year');
        const footerGithubLink = document.getElementById('footer-github-link');
        const markdownModal = document.getElementById('markdown-modal');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeModalFooterBtn = document.getElementById('close-modal-footer-btn');

        // --- Global Config Variable ---
        let portfolioConfig = null;

        // --- Functions ---

        /**
         * Loads and parses YAML data from the script tag.
         * @returns {object|null} Parsed portfolio data object or null on error.
         */
        function loadPortfolioData() {
            if (!yamlDataElement) {
                console.error("YAML data script tag not found!");
                return null;
            }
            try {
                // Use jsyaml.load to parse the YAML content
                const config = jsyaml.load(yamlDataElement.textContent);
                // Basic validation
                if (!config || typeof config !== 'object' || !Array.isArray(config.categories) || !Array.isArray(config.projects)) {
                     console.error("Invalid YAML structure. Expected 'categories' and 'projects' arrays.");
                     return null;
                }
                return config;
            } catch (e) {
                console.error("Error parsing YAML data:", e);
                if (projectColumnsContainer) {
                     projectColumnsContainer.innerHTML = '<p class="text-red-600 col-span-full text-center">Error loading project data. Please check the YAML format.</p>';
                }
                return null;
            }
        }


        /**
         * Creates the HTML for a single project link as a list item.
         * @param {object} project - The project data object.
         * @returns {string} HTML string for the project list item.
         */
        function createProjectLinkListItem(project) {
            const isMarkdown = project.type === 'markdown';
            const linkAttributes = isMarkdown
                ? `href="#" data-markdown-path="${project.url}" data-title="${project.title}"` // Use data attributes for JS handling
                : `href="${project.url}" target="_blank" rel="noopener noreferrer"`; // Standard external link

            // Link styling
            const linkClasses = "text-blue-600 hover:text-blue-800 hover:underline text-sm";

            // Return list item containing the link
            return `
                <li>
                    <a ${linkAttributes} class="${linkClasses} ${isMarkdown ? 'load-markdown-link' : ''}">
                        ${project.title}
                    </a>
                </li>
            `;
        }

        /**
         * Renders project columns and links based on the loaded config.
         */
        function renderPortfolio() {
            if (!portfolioConfig || !projectColumnsContainer) {
                console.error("Portfolio config not loaded or columns container not found.");
                 if (projectColumnsContainer) {
                    projectColumnsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">Could not load portfolio data.</p>';
                 }
                return;
            }

            // Clear loading state or previous content
            projectColumnsContainer.innerHTML = '';

            // Keep track of project counts per category
            const projectCounts = {};

            // 1. Create columns based on categories
            portfolioConfig.categories.forEach(category => {
                if (!category.id || !category.title) {
                    console.warn("Skipping category with missing id or title:", category);
                    return;
                }
                // Initialize count for this category
                projectCounts[category.id] = 0;

                // Create column HTML
                const columnHtml = `
                    <div id="column-${category.id}">
                        <h3 class="text-xl font-semibold mb-2 border-b pb-1 text-gray-800">${category.title}</h3>
                        <ul class="project-list space-y-1" id="project-list-${category.id}">
                            </ul>
                    </div>
                `;
                projectColumnsContainer.insertAdjacentHTML('beforeend', columnHtml);
            });

            // 2. Populate columns with project links
            portfolioConfig.projects.forEach(project => {
                if (!project.category || !portfolioConfig.categories.some(cat => cat.id === project.category)) {
                    console.warn(`Project "${project.title}" has invalid or missing category: ${project.category}. Skipping.`);
                    return;
                }

                const listElement = document.getElementById(`project-list-${project.category}`);
                if (listElement) {
                    const listItemHtml = createProjectLinkListItem(project);
                    listElement.insertAdjacentHTML('beforeend', listItemHtml);
                    projectCounts[project.category]++; // Increment count
                } else {
                    console.warn(`Could not find list element for category: ${project.category}`);
                }
            });

            // 3. Add placeholder text for empty categories
            portfolioConfig.categories.forEach(category => {
                 if (projectCounts[category.id] === 0) {
                     const listElement = document.getElementById(`project-list-${category.id}`);
                     if (listElement) {
                         listElement.innerHTML = '<li class="text-gray-500 text-sm italic list-none">No items listed.</li>'; // Use list-none to remove bullet
                     }
                 }
            });

             // 4. Update Footer
             updateFooter();
        }

        /**
         * Updates the footer content (Year and GitHub link).
         */
        function updateFooter() {
            if (currentYearSpan) {
                currentYearSpan.textContent = new Date().getFullYear();
            }
            if (footerGithubLink && portfolioConfig && portfolioConfig.githubUsername && portfolioConfig.githubUsername !== "your-username") {
                footerGithubLink.href = `https://github.com/${portfolioConfig.githubUsername}`;
                // Optionally update the text part if needed, assuming 'Your Name' needs changing too
                // footerGithubLink.parentElement.innerHTML = `&copy; <span id="current-year">${new Date().getFullYear()}</span> Your Name. Find me on <a id="footer-github-link" href="${footerGithubLink.href}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">GitHub</a>.`;
            } else if (footerGithubLink && (!portfolioConfig || !portfolioConfig.githubUsername || portfolioConfig.githubUsername === "your-username")) {
                 // Keep default or indicate placeholder
                 footerGithubLink.href = `https://github.com/your-username`; // Default placeholder link
                 footerGithubLink.parentElement.querySelector('a').textContent = 'GitHub (Update Username in YAML)';
                 // Or update the whole paragraph:
                 // footerGithubLink.parentElement.innerHTML = `&copy; <span id="current-year">${new Date().getFullYear()}</span> Your Name. Please update GitHub username in the YAML data.`;
            }
        }


        /**
         * Fetches and displays Markdown content in the modal. (No changes needed here)
         * @param {string} path - The relative path to the Markdown file.
         * @param {string} title - The title for the modal.
         */
        async function showMarkdownModal(path, title) {
             if (!markdownModal || !modalContent || !modalTitle) return;

            modalTitle.textContent = title || "Reading Article";
            modalContent.innerHTML = '<p class="text-center text-gray-500 py-8">Loading content...</p>';
            markdownModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            try {
                const response = await fetch(path);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const markdownText = await response.text();
                modalContent.innerHTML = marked.parse(markdownText);
            } catch (error) {
                console.error("Error fetching or parsing Markdown:", error);
                modalContent.innerHTML = `<p class="text-center text-red-600 py-8">Error loading content. Please check the file path and ensure the file exists: ${path}</p>`;
            }
        }

        /**
         * Hides the Markdown modal. (No changes needed here)
         */
        function hideMarkdownModal() {
            if (!markdownModal) return;
            markdownModal.style.display = 'none';
            document.body.style.overflow = '';
            modalContent.innerHTML = '';
            modalTitle.textContent = 'Reading Article';
        }


        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Load data
            portfolioConfig = loadPortfolioData();

            // 2. Render portfolio (handles columns and links)
            renderPortfolio(); // This function now also updates the footer

             // 3. Set up event listener for markdown links (using delegation)
             if(projectColumnsContainer) {
                 projectColumnsContainer.addEventListener('click', (event) => {
                    const link = event.target.closest('a.load-markdown-link'); // Find the closest markdown link
                    if (link) {
                        event.preventDefault(); // Prevent default link behavior
                        const path = link.dataset.markdownPath;
                        const title = link.dataset.title;
                        if (path) {
                            showMarkdownModal(path, title);
                        } else {
                            console.error("Markdown path not found on link:", link);
                            alert("Could not find the article path.");
                        }
                    }
                 });
             } else {
                 console.error("Project columns container not found for event delegation.");
             }
        });

        // Close modal listeners (No changes needed here)
        if (closeModalBtn) closeModalBtn.addEventListener('click', hideMarkdownModal);
        if (closeModalFooterBtn) closeModalFooterBtn.addEventListener('click', hideMarkdownModal);
        if (markdownModal) {
            markdownModal.addEventListener('click', (event) => {
                if (event.target === markdownModal) {
                    hideMarkdownModal();
                }
            });
        }
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && markdownModal.style.display === 'flex') {
                hideMarkdownModal();
            }
        });

    </script>

</body>
</html>
